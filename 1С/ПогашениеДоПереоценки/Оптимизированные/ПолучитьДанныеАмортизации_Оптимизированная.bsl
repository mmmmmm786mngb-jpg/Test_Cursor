Функция ПолучитьДанныеАмортизации(Облигации, ДатаРасчета = '00010101', АмортизацияФиксированнойПоДате = Ложь, Отказ = Ложь) Экспорт //MTF-767
	
	ТаблицаРезультата = Новый ТаблицаЗначений;
	ТаблицаРезультата.Колонки.Добавить("Облигация", Новый ОписаниеТипов("СправочникСсылка.Облигации"));
	ТаблицаРезультата.Колонки.Добавить("КоэффициентАмортизации", Новый ОписаниеТипов("Число"));
	ТаблицаРезультата.Колонки.Добавить("СуммаПогашения", Новый ОписаниеТипов("Число"));
	ТаблицаРезультата.Колонки.Добавить("ОстатокНоминала", Новый ОписаниеТипов("Число"));
	
	СписокАктивов = Новый Массив;
	
	Если ТипЗнч(Облигации) = Тип("СправочникСсылка.Облигации") ИЛИ ТипЗнч(Облигации) = Тип("СправочникСсылка.Активы") Тогда
		СписокАктивов.Добавить(Облигации);
	ИначеЕсли ТипЗнч(Облигации) = Тип("Массив") Тогда
		СписокАктивов = Облигации;
	Иначе
		Отказ = Истина;
		Возврат ТаблицаРезультата;
	КонецЕсли;
	
	Если ДатаРасчета = '00010101' Тогда
		ДатаРасчета = ТекущаяДата();
	КонецЕсли;
	
	//Обработаем массив, возможно переданы активы, а не облигации
	ВидОблигации = ПланыВидовХарактеристик.ВидыАктивов.Облигации;
	СписокОблигаций = Новый Массив;
	
	Для Каждого Элемент Из СписокАктивов Цикл
		
		ТипЭлемента = ТипЗнч(Элемент);
		Если ТипЭлемента = Тип("СправочникСсылка.Облигации") Тогда
			СписокОблигаций.Добавить(Элемент);
			// ОПТИМИЗАЦИЯ: Используем проверку типа вместо медленного метода ПринадлежитЭлементу()
			// - Получаем реквизит ВидАктива через метод ОбщегоНазначения.ЗначениеРеквизитаОбъекта() для безопасного чтения без загрузки объекта
			// - Все виды в иерархии "Облигации" имеют ТипЗначения = СправочникСсылка.Облигации
			// - Проверяем принадлежность через ТипЗначения.СодержитТип() без обращения к БД
			// Это позволяет избежать множественных запросов к БД для проверки иерархии
		ИначеЕсли ТипЭлемента = Тип("СправочникСсылка.Активы") Тогда
			ВидАктива = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Элемент, "ВидАктива");
			Если ВидАктива.ТипЗначения.СодержитТип(Тип("СправочникСсылка.Облигации")) Тогда
				СписокОблигаций.Добавить(Элемент.Объект);
			КонецЕсли;
		КонецЕсли;
		
	КонецЦикла;
	/// -- код ---
КонецФункции
// ИЗМЕНЕНИЕ 1: Первые два запроса (обороты и остатки по основным счетам ЦБ) выделены в отдельную виртуальную таблицу
// ИЗМЕНЕНИЕ 2: Переименована таблица ТаблицаВсеЦБ -> ВТ_ОбъектыОсновныхСчетов (с префиксом ВТ_ для ясности)
ВЫБРАТЬ
	ХозрасчетныйОбороты.Субконто1 КАК Субконто1
ПОМЕСТИТЬ ВТ_ОбъектыОсновныхСчетов
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаН, &ДатаК, Период, Счет В (&СчетаЦБ), , Портфель = &Портфель, , ) КАК ХозрасчетныйОбороты
ГДЕ
	ХозрасчетныйОбороты.КоличествоОборот <> 0

	// ИЗМЕНЕНИЕ 3: ОБЪЕДИНИТЬ ВСЕ заменено на ОБЪЕДИНИТЬ для автоматического удаления дублей
ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ХозрасчетныйОстатки.Субконто1
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(&ДатаК, Счет В (&СчетаЦБ), , Портфель = &Портфель) КАК ХозрасчетныйОстатки
ГДЕ
	ХозрасчетныйОстатки.КоличествоОстаток <> 0

	// ИЗМЕНЕНИЕ 4: Добавлен индекс по Субконто1 для оптимизации соединения со справочником Активы
ИНДЕКСИРОВАТЬ ПО
	Субконто1
;

////////////////////////////////////////////////////////////////////////////////
// ИЗМЕНЕНИЕ 5: Создана вторая виртуальная таблица ВТ_Активы, которая:
// - Преобразует объекты из ВТ_ОбъектыОсновныхСчетов в ссылки на Активы
// - Объединяет с данными из дополнительных счетов (обороты и остатки)
// ИЗМЕНЕНИЕ 6: Переименована ТаблицаВсеЦБ -> ВТ_Активы (с префиксом ВТ_)
ВЫБРАТЬ
	Активы.Ссылка КАК Актив
ИЗ
	ВТ_ОбъектыОсновныхСчетов КАК ВТ_ОбъектыОсновныхСчетов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Активы КАК Активы
		ПО ВТ_ОбъектыОсновныхСчетов.Субконто1 = Активы.Объект
			И (Активы.ВидАктива В ИЕРАРХИИ (&ВидыАктивов))

	// ИЗМЕНЕНИЕ 7: Третий и пятый запросы (обороты по дополнительным счетам) объединены в один
	// Используется Счет В (&СчетаДополнительные) вместо отдельных условий для каждого счета
ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ХозрасчетныйОбороты.Субконто1
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаН, &ДатаК, Период, Счет В (&СчетаДополнительные), &ВидыСубконто, Портфель = &Портфель, , ) КАК ХозрасчетныйОбороты
ГДЕ
	ХозрасчетныйОбороты.КоличествоОборот <> 0
	И ВЫРАЗИТЬ(ХозрасчетныйОбороты.Субконто1 КАК Справочник.Активы) В ИЕРАРХИИ (&ВидыАктивов)

	// ИЗМЕНЕНИЕ 8: Четвертый и шестой запросы (остатки по дополнительным счетам) объединены в один
ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ХозрасчетныйОстатки.Субконто1
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(&ДатаК, Счет В (&СчетаДополнительные), &ВидыСубконто, Портфель = &Портфель) КАК ХозрасчетныйОстатки
ГДЕ
	ХозрасчетныйОстатки.КоличествоОстаток <> 0
	И ВЫРАЗИТЬ(ХозрасчетныйОстатки.Субконто1 КАК Справочник.Активы) В ИЕРАРХИИ (&ВидыАктивов)
	// ИЗМЕНЕНИЕ 9: Добавлен параметр &ВидыСубконто для приведения Субконто2 и Субконто3 к Субконто1
	// Теперь все субконто доступны через Субконто1 без использования ВЫРАЗИТЬ и .Объект

Функция МенеджерКотировокПоСпискуЦБ(Дата, СписокЦенныхБумаг) Экспорт
	
	МенеджерВТ = Новый МенеджерВременныхТаблиц;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
	
	// ОПТИМИЗАЦИЯ: Вычисляем начало дня на клиенте, чтобы не использовать функцию НАЧАЛОПЕРИОДА() в запросе
	// Это позволяет серверу использовать индексы более эффективно
	ДатаНачалаДня = НачалоДня(Дата);
	Запрос.УстановитьПараметр("Период", ДатаНачалаДня);
	Запрос.УстановитьПараметр("СписокЦБ", СписокЦенныхБумаг);
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	*
		|ПОМЕСТИТЬ ТаблицаКотировок
		|ИЗ
		|	РегистрСведений.КотировкиЦБНаБирже КАК КотировкиЦБНаБирже
		|ГДЕ
		|	НАЧАЛОПЕРИОДА(КотировкиЦБНаБирже.Период, ДЕНЬ) = &Период
		|	И КотировкиЦБНаБирже.Актив В(&СписокЦБ)
		|
		|ИНДЕКСИРОВАТЬ ПО НАБОР
		|	(Актив, Биржа),
		|	Актив,
		|	Биржа
		|	
		|// ОПТИМИЗАЦИЯ ИНДЕКСОВ: Для версии 8.3.25+
		|// Создаем 3 индекса в ВТ для оптимальной производительности:
		|// 1. Составной индекс (Актив, Биржа) - для JOIN по обоим полям
		|// 2. Индекс по Актив - для фильтрации по активу
		|// 3. Индекс по Биржа - для фильтрации по бирже
		|// Это обеспечивает эффективный поиск при любой комбинации условий";
	
	Результат = Запрос.Выполнить();
	
	ЗапросДляЛога = Запрос;
	ЗапросДляЛога.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	ОбщегоНазначенияДУ.ДобавитьВЛогОтладки(ЗапросДляЛога, "Документ.УстановкаКотировок.МенеджерКотировокПоСпискуЦБ");
	
	Возврат МенеджерВТ;
	
КонецФункции
# Правила разработки на 1С:Enterprise в Cursor

## ОБЩИЙ КОНТЕКСТ

- **Платформа**: 1С:Enterprise (фокус на управляемом приложении, тонком/толстом клиенте). Минимальная версия: не ниже 8.3.21.
- **Язык**: Встроенный язык 1С (BSL, с учетом специфики клиент/сервер).
- **Объекты**: Используй встроенные типы (Справочник, Документ, Регистр, Перечисление, Константа). Избегай пользовательских типов без необходимости.

## СТИЛЬ КОДА

### Именование

- **Локальные переменные**: `PascalCase` (ТекущийПользователь, КоличествоЭлементов).
- **Объекты метаданных**: `PascalCase` (СправочникНоменклатура, ДокументПродажа).
- **Процедуры/Функции**: `PascalCase` с глаголами (РассчитатьСумму, ПолучитьДанные).
- **Константы**: `ВЕРХНИЙ_РЕГИСТР` (МАКСИМАЛЬНОЕ_КОЛИЧЕСТВО).
- **Параметры**: `PascalCase` (ОбъектДокумента, СписокЭлементов).
- **Ключевые слова**: Используй стандартные ключевые слова 1С с правильным регистром:
  - `Не` вместо `НЕ`
  - `Или` вместо `ИЛИ`
  - `И` вместо `И`
  - `Тогда` вместо `ТОГДА`
  - `КонецЕсли` вместо `КОНЕЦЕСЛИ`
  - `КонецЦикла` вместо `КОНЕЦЦИКЛА`
  - `КонецПопытки` вместо `КОНЕЦПОПЫТКИ`

### Форматирование

- **Отступы**: 4 пробела (НЕ табы).
- **Длина строки**: Не более 140 символов (используй переносы для длинных запросов).
- **Блоки**: Всегда закрывай (`КонецПроцедуры`, `КонецЕсли`, `КонецПопытки`).
- **Пробелы**: Отделяй операторы, параметры, ключевые слова.
- **Пустые строки**: Между логическими блоками для читаемости.
- **Чистота кода**: В текстах программы не должно быть концевых пробелов и табуляций (удаляй trailing whitespace).

## АРХИТЕКТУРНЫЕ РЕШЕНИЯ

### Работа с Управляемыми Формами

- **Четкое разделение Client/Server**:
  - **&НаКлиенте**: Только логика интерфейса (проверки, видимость, доступность). Никаких запросов к базе данных.
  - **&НаСервере**: Вся бизнес-логика, запросы и обработка данных.
  - **&НаСервереБезКонтекста**: Для процедур, не зависящих от данных формы (например, утилитарные функции).
- **Минимизация серверных вызовов**: Группируй несколько вызовов в одну серверную процедуру (пример: пакетный расчет в одной процедуре).

- **Создание новых управляемых форм (всегда использовать аналоги)**:
  - **ВСЕГДА** ищи и используй существующие аналоги форм из типовых конфигураций (например, формы списков, выбора или редактирования из БСП или стандартных объектов).
  - **Точное соответствие структуры**: Копируй структуру файлов и папок аналога (например, `Form.xml`, `Module.bsl`, поддиректории для элементов). Используй EDT для экспорта/импорта форм.
  - **Внутренняя структура файлов**:
    - Описание типов элементов (реквизиты, команды, элементы интерфейса) — строго копируй из аналога.
    - Теги и атрибуты (в XML): Смотри как у аналогов (например, `<ExtendedObject>`, `<Command>`, `<Field>`). Добавляй/изменяй только то, что необходимо для решения задачи (например, добавь новый реквизит, но сохрани все базовые теги).
  - **UUID/GUID**: Генерируй строго в соответствии со стандартами 1С (формат: 8-4-4-4-12 шестнадцатеричных символов, например, `a3b4c5d6-e7f8-9g0h-1i2j-3k4l5m6n7o8p`). Используй встроенную функцию `Новый УникальныйИдентификатор()` для автоматизации.
  - **Пример**: Если создаешь форму списка справочника, скопируй структуру из типовой формы `Справочник.Номенклатура.ФормаСписка`, добавь только нужные поля, сохранив все UUID и теги.

### Использование Общих Модулей

- **Правильная установка флагов**: `Сервер`, `Клиент (управляемое приложение)`, `Вызов сервера`.
- **Использование БСП**: Как альтернативу, используй готовые подсистемы БСП для стандартных задач (пользователи, настройки, печать), если БСП доступна.

### Интеграции и API

- **HTTP-сервисы**: Предпочтительный способ для создания RESTful API (пример: `HTTPСервис` с методами GET/POST).
- **Работа с JSON/XML**: Используй встроенные объекты `ЧтениеJSON`, `ЗаписьJSON`. Всегда работай с данными через `Прочитать()` в `Попытка...Исключение` (защищай от ошибок парсинга). Для XML в приоритете используй XDTO для сериализации/десериализации.
- **Логирование интеграций**: Всегда логируй тела запросов и ответов. Используй `ЖурналРегистрации` для аудита.

## СТАНДАРТЫ 1С

### Константы

- Не используем Константы, все осуществляем через структуру Параметров
- Не используем глобальные переменные, все осуществляем через структуру Параметров

### Запросы

- **СКД**: Для сложных отчетов.
- **Параметры**: Всегда используй параметры, НЕ конкатенацию строк.
- **Вложенные запросы**: Избегай, используй `ВРЕМЕННЫЕ ТАБЛИЦЫ`.
- **Производительность**: Ограничивай выборку (`ПЕРВЫЕ N`), используй индексы.

## ОБРАБОТКА ОШИБОК

### Принципы использования Попытка

- **ИСПОЛЬЗУЙ РЕДКО**: `Попытка...Исключение` только когда ошибка может быть неопределена
- **НЕ ИСПОЛЬЗУЙ** для предсказуемых ситуаций (проверка прав, валидация данных)
- **ИСПОЛЬЗУЙ** только для:
  - Внешних интеграций (HTTP-запросы, работа с файлами)
  - Операций с базой данных, где может произойти неожиданная ошибка
  - Работы с внешними компонентами
  - Парсинга данных неизвестного формата

### Предпочтительные альтернативы

- **Проверка прав**: `Если НЕ ПравоДоступа() Тогда`
- **Валидация данных**: `Если НЕ ЗначениеЗаполнено() Тогда`
- **Проверка типов**: `Если ТипЗнч() = Тип() Тогда`
- **Проверка существования**: `Если НЕ ЗначениеЗаполнено(Ссылка) Тогда`

### Когда НЕ использовать Попытка

- Для проверки прав доступа
- Для валидации входных параметров
- Для проверки существования объектов
- Для проверки заполненности полей
- Для стандартных проверок данных

### Правильная структура Попытка

```bsl
Попытка
    // Только код, где ошибка может быть неопределена
    // Например: HTTP-запрос, работа с файлом, парсинг JSON
Исключение
    ТекстОшибки = "Операция: " + ОписаниеОшибки();
    ЗаписьЖурналаРегистрации("ОшибкаОперации", УровеньЖурналаРегистрации.Ошибка, , , ТекстОшибки);
    // Обработка ошибки
КонецПопытки;
```

## ТЕСТИРОВАНИЕ

- **Логическое тестирование по тексту**: Проверяй логику кода через анализ текста (code review, статический анализ).
- **Преобразование для тестов**: Преобразуй код 1С в Python для модульного тестирования, а запросы 1С в SQLite для симуляции баз данных.
- **Тестирование API**: Проводить через Python (используй библиотеки вроде `requests` для симуляции запросов).

## ПОВЕДЕНИЕ ИИ

### Рефакторинг

- **Объяснения**: Детально объясняй изменения.
- **Тестирование**: Предлагай план тестирования.
- **Обратная совместимость**: Учитывай существующий код.

### Ограничения

- **Внешние библиотеки**: НЕ предлагай (1С — закрытая платформа).
- **Встроенные объекты**: Фокусируйся на возможностях платформы.

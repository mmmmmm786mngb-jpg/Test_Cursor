# Правило работы с русской кодировкой и кракозябрами

## Проблема

В Windows консоли и некоторых редакторах русские символы отображаются как кракозябры из-за проблем с кодировкой. Это происходит из-за несоответствия между UTF-8 (стандарт для веб и современных систем) и устаревшими кодировками Windows (CP1251, CP866).

## Решения

### 1. Для Python скриптов

- **ВСЕГДА** добавляй `#!/usr/bin/env python3` в первую строку.
- **ВСЕГДА** добавляй `# -*- coding: utf-8 -*-` во вторую строку.
- **ВСЕГДА** используй `encoding='utf-8'` при работе с файлами (`open('file.txt', 'w', encoding='utf-8')`).
- **ВСЕГДА** добавляй docstring с описанием на русском языке.
- **КЛЮЧЕВОЕ ПРАВИЛО:** Для консольного вывода (`print()`) **ИСПОЛЬЗУЙ ТОЛЬКО ASCII СИМВОЛЫ**. Это самая надежная защита от `UnicodeEncodeError` и кракозябр в любой среде.
- **ВСЕГДА** заменяй специальные символы на их ASCII эквиваленты перед выводом в консоль (см. таблицу ниже).
- **НОВОЕ: Автоматическая проверка кодировки в скрипте** - Добавляй в начало скрипта код для настройки среды (см. пример ниже).

### 2. Для консольных команд

- **ВСЕГДА** перед выполнением Python скриптов выполняй настройку консоли.
- **Для PowerShell (рекомендуется):** `[Console]::OutputEncoding = [System.Text.Encoding]::UTF8`
- **Для CMD:** `chcp 65001`
- **ВСЕГДА** устанавливай переменную окружения Python: `$env:PYTHONIOENCODING = "utf-8"` (в PowerShell) или `set PYTHONIOENCODING=utf-8` (в CMD).
- **НОВОЕ: Используй скрипт-обертку** - Создай PowerShell скрипт для запуска Python с настройкой (см. ниже).

### 3. Для файлов

- **ВСЕГДА** создавай файлы с **АНГЛИЙСКИМИ** именами, если планируется работа с ними из консоли.
- **ВСЕГДА** используй кодировку UTF-8 для всех текстовых файлов (.py, .txt, .md, .json и т.д.).
- **НЕ ДОБАВЛЯЙ** BOM (Byte Order Mark) в начало текстовых файлов. Современные инструменты и Git корректно работают с UTF-8 без BOM, а BOM может вызывать проблемы в CLI/CI, при парсинге и сравнениях.

### 4. Работа со специальными символами (Самое важное для консоли)

- **НИКОГДА** не выводи напрямую в консоль символы вроде `✓`, `°`, `π`, `₽`.
- **ВСЕГДА** заменяй их на безопасные ASCII аналоги перед `print()`.

## Таблица замены специальных символов

| Категория | Специальный символ | ASCII замена | Описание |
|---|---|---|---|
| **Математика** | π, α, β, γ | pi, alpha, beta, gamma | Греческие буквы |
| | ∠, √, ∞, ± | ugol, sqrt, inf, +/- | Математические знаки |
| **Статус** | ✓, ✗ | OK, ERROR | Галочка и крестик |
| | →, ←, ↑, ↓ | ->, <-, ^, v | Стрелки |
| **Валюты/Единицы**| €, £, ¥, ₽ | EUR, GBP, JPY, RUB | Валюты |
| | °, ℃, ℉ | deg, C, F | Градусы |
| **Другое** | ©, ®, ™ | (c), (R), (TM) | Знаки охраны |

## Примеры правильного кода

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Пример правильного скрипта для работы с кириллицей.
"""

# Создание файла с правильной кодировкой
with open('data_russian.txt', 'w', encoding='utf-8') as f:
    f.write('Русский текст ✓') # В файл пишем как есть

# Вывод в консоль - БЕЗ специальных символов
print("Russkiy tekst bez problem")
print("Ugol = 45 gradusov")  # Вместо ∠45°
print("Koren iz 2 =", 2**0.5)  # Вместо √2
print("OK - operaciya vypolnena")  # Вместо ✓
```

## Автоматическая настройка консоли

### При первом запуске в сессии выполни в PowerShell

```powershell
# Настройка кодировки для PowerShell
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::InputEncoding = [System.Text.Encoding]::UTF8

# Настройка кодировки для cmd-совместимых приложений
chcp 65001

# Настройка переменных окружения Python
$env:PYTHONIOENCODING = "utf-8"

# Проверка настройки
Write-Host "Тест русских символов: Привет, мир!" -ForegroundColor Green
```

### **НОВЫЙ РАЗДЕЛ: Автоматизация для постоянного применения**

Чтобы правило применялось **ВСЕГДА** автоматически:

1. **Измените профиль PowerShell (постоянно для всех сессий):**
   - Откройте профиль: `notepad $PROFILE` (если файла нет, он создастся).
   - Добавьте в файл:

     ```
     [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
     [Console]::InputEncoding = [System.Text.Encoding]::UTF8
     $env:PYTHONIOENCODING = "utf-8"
     chcp 65001 | Out-Null
     ```

   - Сохраните и перезапустите PowerShell.
   - **Проверка:** Выполните `Write-Host "Тест: Привет, мир!"` - текст должен быть нормальным.

2. **Создайте скрипт-обертку для запуска Python (для отдельных скриптов):**
   - Сохраните как `Run_Python_With_Encoding.ps1`:

     ```
     param ([string]$ScriptPath)
     [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
     [Console]::InputEncoding = [System.Text.Encoding]::UTF8
     $env:PYTHONIOENCODING = "utf-8"
     chcp 65001 | Out-Null
     if ($ScriptPath) { python $ScriptPath } else { Write-Host "Укажите скрипт: .\Run_Python_With_Encoding.ps1 'script.py'" }
     ```

   - Запускайте: `.\Run_Python_With_Encoding.ps1 'your_script.py'`.

3. **В Python скриптах добавляйте автоматическую замену символов:**
   - Используйте функцию `safe_print(text)` для вывода (см. обновленный пример кода ниже).

## Обновленный пример правильного кода

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Пример правильного скрипта с автоматизацией.
"""

import sys

def safe_print(text):
    """Безопасный вывод - только ASCII"""
    try:
        print(text)
    except UnicodeEncodeError:
        print(text.encode('ascii', 'replace').decode('ascii'))

# Создание файла
with open('data.txt', 'w', encoding='utf-8') as f:
    f.write('Русский текст ✓')

# Вывод в консоль
safe_print("Russkiy tekst bez problem")
safe_print("OK - operaciya vypolnena")
```

## Что НЕ делать (Анти-паттерны)

- **НЕ** создавай файлы с русскими именами для консольных команд.
- **НЕ** игнорируй кодировку при работе с файлами (`open('file.txt', 'w')` - это ошибка).
- **НЕ** используй `print()` со специальными символами (`print("✓ Успех!")` - это критическая ошибка, которая может привести к падению программы).
- **НЕ** забывай настраивать консоль перед запуском скриптов.

## Альтернативы для отображения сложного вывода

Если нужно вывести красивые отчеты с кириллицей и спецсимволами, **не используй консоль**. Вместо этого:

1. **Сгенерируй HTML файл** и открой его в браузере.
2. **Сохрани результат в .txt или .md файл** в кодировке UTF-8 и открой в редакторе.
3. **Выведи данные в JSON** и просмотри в специальном редакторе.
